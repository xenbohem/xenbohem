<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Chimera Quest CafÃ©</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Inter&display=swap" rel="stylesheet">
<style>
:root{
  --cornflower:#6fa8ff;
  --cafe-grey:#d8d8dc;
  --coffee:#4b3325;
}
*{box-sizing:border-box;}
body{
  margin:0;
  height:100vh;
  background:
    radial-gradient(circle at center, transparent 60%, rgba(75,51,37,0.6) 100%),
    linear-gradient(135deg,var(--cornflower),var(--cafe-grey));
  display:flex;
  justify-content:center;
  align-items:center;
  font-family:Inter,system-ui;
  overflow:hidden;
}
#cafe-frame{
  width:92vw;
  height:90vh;
  background:rgba(10,10,20,0.75);
  border-radius:22px;
  box-shadow:0 0 80px rgba(0,0,0,0.7);
  backdrop-filter:blur(12px);
  position:relative;
  overflow:hidden;
}
#header{
  height:70px;
  background:linear-gradient(180deg,rgba(40,35,70,0.9),rgba(10,10,20,0.7));
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:Cinzel,serif;
  letter-spacing:3px;
  font-size:28px;
  color:#e9dcff;
}
.drawer-btn{
  position:absolute;
  top:18px;
  font-size:24px;
  cursor:pointer;
}
#music-btn{left:20px;}
#tea-btn{right:20px;}
#forum-stage{
  position:absolute;
  top:90px;
  left:50%;
  transform:translateX(-50%);
  width:70%;
  height:75%;
  background:rgba(25,20,45,0.9);
  border-radius:20px;
  padding:20px;
  color:white;
  overflow-y:auto;
}
.post{
  padding:10px;
  margin-bottom:10px;
  background:rgba(255,255,255,0.05);
  border-radius:10px;
  display:flex;
  flex-direction:column;
}
.author{
  font-size:12px;
  opacity:.7;
  display:flex;
  align-items:center;
  margin-bottom:4px;
}
.author img {
  vertical-align: middle;
  border-radius:50%;
  width:30px;
  height:30px;
  margin-right:8px;
}
.reply-button{
  font-size:12px;
  margin-left:38px;
  cursor:pointer;
  color:#c3b0ff;
}
.reply-box{
  display:flex;
  gap:10px;
  margin-top:5px;
  margin-left:38px;
}
.reply-box input{
  flex:1;
  border-radius:8px;
  padding:5px;
}
.reply-box button{
  border-radius:8px;
  padding:5px 10px;
}
#new-post-box{
  display:flex;
  gap:10px;
  margin-top:10px;
}
#new-post-box input{
  flex:1;
  border-radius:8px;
  padding:5px;
}
#new-post-box button{
  border-radius:8px;
  padding:5px 10px;
}
#name-gate{
  position:absolute;
  width:100%;
  height:100%;
  background:rgba(0,0,0,.85);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:15;
}
#name-box{
  background:#221a3a;
  padding:40px;
  border-radius:20px;
}
#tea-drawer{
  position:absolute;
  right:-300px;
  top:0;
  width:300px;
  height:100%;
  background:#3a2a1f;
  transition:.6s;
  padding:90px 20px;
}
#music-drawer{
  position:absolute;
  top:-250px;
  left:0;
  width:100%;
  height:250px;
  background:#1b1533;
  transition:.6s;
  padding:90px 20px;
}
</style>
</head>

<body>
<div id="cafe-frame">

<!-- Name Gate -->
<div id="name-gate">
  <div id="name-box">
    <h2>Welcome to Chimera Quest CafÃ©</h2>
    <input id="username-input" placeholder="Your name"/>
    <button id="enter-cafe">Enter</button>
  </div>
</div>

<!-- Header -->
<div id="header">
  <span id="music-btn" class="drawer-btn">ðŸŽ¶</span>
  CHIMERA QUEST CAFÃ‰
  <span id="tea-btn" class="drawer-btn">â˜•</span>
</div>

<!-- Forum -->
<div id="forum-stage"></div>

<!-- New top-level post box -->
<div id="new-post-box">
  <input id="new-post-input" placeholder="Write a new post...">
  <button id="new-post-send">Send</button>
</div>

<!-- Drawers -->
<div id="tea-drawer">â˜• Starâ€™s Tea Shelf</div>
<div id="music-drawer">ðŸŽ¶ CafÃ© Soundtrack</div>

</div>

<script>
// -----------------------------
// AVATARS
// -----------------------------
const avatars = {
  Hans: "https://i.imgur.com/QaR1D7x.png",
  Star: "https://i.imgur.com/FxVQ2yx.png",
  Milo: "https://i.imgur.com/kQ8V2sL.png",
  User: "https://i.imgur.com/yourUserIcon.png"
};

// -----------------------------
// NAME GATE
// -----------------------------
let name = localStorage.getItem("chimeraName");
const nameGate = document.getElementById("name-gate");
if(!name) nameGate.style.display="flex";
else nameGate.style.display="none";

document.getElementById("enter-cafe").onclick = ()=>{
  name = document.getElementById("username-input").value.trim();
  if(!name) return;
  localStorage.setItem("chimeraName", name);
  nameGate.style.display="none";
  renderForum();
};

// -----------------------------
// DRAWERS
// -----------------------------
const tea = document.getElementById("tea-drawer");
const music = document.getElementById("music-drawer");
document.getElementById("tea-btn").onclick = ()=> tea.style.right = tea.style.right==="0px"? "-300px":"0px";
document.getElementById("music-btn").onclick = ()=> music.style.top = music.style.top==="0px"? "-250px":"0px";

// -----------------------------
// FORUM DATA
// -----------------------------
let forum = JSON.parse(localStorage.getItem("chimeraForum")) || [
  {id:1, author:"Star", text:"Does Earl Grey remember the people who drank it before us?", replies:[]},
  {id:2, author:"Hans", text:"Earl Grey was here before most of us. I distrust any tea that has outlived its drinkers.", replies:[]}
];

let postIdCounter = forum.length+1;

// -----------------------------
// RENDERING NESTED POSTS
// -----------------------------
const forumStage = document.getElementById("forum-stage");

function renderPosts(postsArray, container, level=0){
  postsArray.forEach(post=>{
    const div = document.createElement("div");
    div.className="post";
    div.style.marginLeft = `${level*20}px`;

    const avatarName = (post.author===name)? "User":post.author;
    const avatar = `<img src="${avatars[avatarName]||''}" alt="${avatarName}">`;

    div.innerHTML = `<div class="author">${avatar}${post.author}</div>${post.text}<div class="reply-button">Reply</div>`;

    // Add reply box when clicking reply
    div.querySelector(".reply-button").onclick = ()=>{
      if(div.querySelector(".reply-box")) return;
      const replyBox = document.createElement("div");
      replyBox.className="reply-box";
      replyBox.innerHTML=`<input placeholder="Your reply..."><button>Send</button>`;
      div.appendChild(replyBox);
      replyBox.querySelector("button").onclick = ()=>{
        const text = replyBox.querySelector("input").value.trim();
        if(!text) return;
        const newPost={id:postIdCounter++, author:name, text, replies:[]};
        post.replies.push(newPost);
        localStorage.setItem("chimeraForum", JSON.stringify(forum));
        renderForum();
      }
      replyBox.querySelector("input").addEventListener("keydown", e=>{
        if(e.key==="Enter"){
          e.preventDefault();
          replyBox.querySelector("button").click();
        }
      });
    };

    container.appendChild(div);
    if(post.replies && post.replies.length>0){
      renderPosts(post.replies, container, level+1);
    }
  });
}

function renderForum(){
  forumStage.innerHTML="";
  renderPosts(forum, forumStage);
}
renderForum();

// -----------------------------
// NEW TOP-LEVEL POST
// -----------------------------
document.getElementById("new-post-send").onclick = ()=>{
  const input = document.getElementById("new-post-input");
  const text = input.value.trim();
  if(!text) return;
  const newPost = {id: postIdCounter++, author: name, text, replies: []};
  forum.push(newPost);
  localStorage.setItem("chimeraForum", JSON.stringify(forum));
  input.value = "";
  renderForum();
};

document.getElementById("new-post-input").addEventListener("keydown", e=>{
  if(e.key==="Enter"){
    e.preventDefault();
    document.getElementById("new-post-send").click();
  }
});
</script>
</body>
</html>
